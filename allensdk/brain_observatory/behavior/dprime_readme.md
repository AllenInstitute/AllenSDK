# A brief description of the use of dprime as applied in the AllenSDK for quantifying performance

## Motivation:
A common metric of sensitivity/discriminability in go/no-go experiment is d', which provides a measure the separation of the hit and false alarm rates. More specifically, the metric assumes that the observer is drawing from normally distributed signal and noise distributions with equal standard deviations. d' is thus defined as:

    d' = Z(hit rate) - Z(false alarm rate)

where Z represents the inverse of the cumulative normal distribution. 

Both the hit rate and the false alarm rate are calculated using traditional signal detection theory framework, in which the hit rate is the probability of response given when the stimulus is present and the false alarm rate is the probability of response when the signal is absent. In a go/no-go task:

    hit rate = (number of responses on go trials)/(number of go trials)
    false alarm rate = (number of responses on no-go trials)/(number of no-go trials)

For a more in-depth discussion of d', see the "Understanding Yes-No Data" section in Chapter 1 of Macmillan and Creelman's "Detection Theory" text [1] (https://books.google.com/books/about/Detection_Theory.html?id=jrDHjTQ4_U4C) or the "Sensitivity Index" entry on Wikipedia (https://en.wikipedia.org/wiki/Sensitivity_index).


## Correction to avoid infinite values
An important point to note about d' is that the metric will be infinite with perfect performance, given that Z(0) = -infinity and Z(1) = infinity. Low trial counts exacerbate this issue. For example, with only one sample of a go-trial, the hit rate will either be 1 or 0. Macmillan and Creelman [1] offer a correction on the hit and false alarm rates to avoid infinite values whereby the response probabilities (P) are bounded by functions of trial count, N:

    1/(2N) < P < 1 - 1/(2N)

Thus, for the example of just a single trial, the trial-corrected hit rate would be 0.5. Or after only two trials, the hit rate could take on the values of 0.25, 0.5, or 0.75. 

## Application of these functions in the `behavior_ophys_session` API:

The session object generated by the behavior_ophys_session API contains a method called `get_rolling_performance_df`. This method will calculate the hit rate, false alarm rate and d' over a rolling window (default size = 100 trials) and will return a dataframe with the following columns:

| Variable Name |Definition  
|:--- |:---
| reward_rate | The number of rewards earned in the window, divided by the elapsed time over the window (units = rewards/minute). This metric can be a useful proxy of engagement (low reward rate = disengagement) 
| hit_rate_raw | The uncorrected hit rate, calculated as the number of hits divided by the number of go-trials in the sliding window
| hit_rate | The hit rate after applying the trial count correction (to avoid extreme values)
| false_alarm_rate_raw | The uncorrected false alarm rate, calculated as the number of false alarms divided by the number of catch-trials in the sliding window
| false_alarm_rate | The false alarm rate after applying the trial count correction
| rolling_dprime | d' calculated using the trial-count-corrected hit and false alarm rates. Note that d' is undefined until there has been at least one go and catch trial.


[1] Macmillan, Neil A., and C. Douglas Creelman. Detection theory: A user's guide. Psychology press, 2004.
